---
title: "structural_analysis"
output: html_document
date: "2024-10-01"
---

```{r}
library(corrplot)
aparc_stats <- read.csv("../data/structural/aparc_stats_10124.csv")

aparc_stats_sub <- aparc_stats[, -1]
cor_matrix <- cor(aparc_stats_sub)

# Function to compute significance levels
cor.mtest <- function(mat, conf.level = 0.95) {
  mat <- as.matrix(mat)
  n <- ncol(mat)
  p.mat <- matrix(NA, n, n)
  diag(p.mat) <- 0
  for (i in 1:(n - 1)) {
    for (j in (i + 1):n) {
      tmp <- cor.test(mat[, i], mat[, j], conf.level = conf.level)
      p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
    }
  }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}

# Compute p-values
p_values <- cor.mtest(cor_matrix)

# Specify the folder where you want to save the file
output_folder <- "../results/structural/"

# Combine the folder path with the file name
output_file <- file.path(output_folder, "Structural MRI Correlations.png")

# Open a PNG device with the specified file path
png(output_file, width = 800, height = 800)

corrplot(cor_matrix, method = "circle", type = "upper", 
         p.mat = p_values, sig.level = 0.05, insig = "blank",
         tl.col = "black", tl.srt = 45, addCoef.col = NULL)

# Close the PNG device
dev.off()

```